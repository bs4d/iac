---
- name: set config files (pc only)
  when: inventory_hostname == "pc"
  loop:
    - { src: gitconfig.j2, dest: .gitconfig }
    - { src: ssh-config.j2, dest: .ssh/config }
  template:
    src: "{{ item.src }}"
    dest: "{{ ansible_env.HOME }}/{{ item.dest }}"

- name: create ~/.config directory for both users
  loop:
    - { path: /root,                    become: true }
    - { path: "{{ ansible_env.HOME }}", become: false }
  become: "{{ item.become }}"
  file:
    state: directory
    path: "{{ item.path }}/.config"

- name: set up zsh for both users
  loop:
    - { user: root,                     home: /root,                    become: true }
    - { user: "{{ ansible_env.USER }}", home: "{{ ansible_env.HOME }}", become: false }
  include_tasks: zsh.yml
  args:
    apply:
      become: "{{ item.become }}"

- name: symlink the neovim binary to vim
  become: true
  file:
    state: link
    src: /usr/bin/nvim
    dest: /usr/bin/vim

- name: (pc only) set the neovim config
  include_tasks: nvim.yml

- name: set up vdirsyncer (pc only)
  when: inventory_hostname == "pc"
  include_tasks: vdirsyncer.yml

- name: add user to the docker group (pc only)
  when: inventory_hostname == "pc"
  become: true
  user:
    name: "{{ ansible_env.USER }}"
    groups: docker
    append: true

- name: enable sddm autologin (pc only)
  when: inventory_hostname == "pc"
  become: true
  blockinfile:
    create: true
    path: /etc/sddm.conf.d/kde_settings.conf
    block: |
      [Autologin]
      Relogin=false
      Session=plasmax11
      User={{ ansible_env.USER }}
